{"ast":null,"code":"import _toConsumableArray from\"C:/Users/DELL/Desktop/E-Election-DAPP/blockchain/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _regeneratorRuntime from\"C:/Users/DELL/Desktop/E-Election-DAPP/blockchain/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"C:/Users/DELL/Desktop/E-Election-DAPP/blockchain/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"C:/Users/DELL/Desktop/E-Election-DAPP/blockchain/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"C:/Users/DELL/Desktop/E-Election-DAPP/blockchain/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"C:/Users/DELL/Desktop/E-Election-DAPP/blockchain/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"C:/Users/DELL/Desktop/E-Election-DAPP/blockchain/node_modules/@babel/runtime/helpers/esm/createSuper\";import React,{Component}from'react';import Web3 from'web3';import Election from'../../build/Election.json';import{Link}from'react-router-dom';var divStyle={backgroundColor:\"lightblue\",marginTop:\"10px\",borderRadius:\"10px\"};var Vote=/*#__PURE__*/function(_Component){_inherits(Vote,_Component);var _super=_createSuper(Vote);function Vote(props){var _this;_classCallCheck(this,Vote);_this=_super.call(this,props);_this.handleInputChange=function(e){console.log(e.target.id);_this.setState({selectedId:e.target.id});_this.vote(e.target.id);};_this.state={id:null,account:'',election:null,candCount:0,candidates:[],loading:true,selectedId:null};return _this;}_createClass(Vote,[{key:\"componentWillMount\",value:function(){var _componentWillMount=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return this.loadWeb3();case 2:_context.next=4;return this.loadBlockchainData();case 4:case\"end\":return _context.stop();}}},_callee,this);}));function componentWillMount(){return _componentWillMount.apply(this,arguments);}return componentWillMount;}()},{key:\"loadWeb3\",value:function(){var _loadWeb=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:if(!window.ethereum){_context2.next=6;break;}window.web3=new Web3(window.ethereum);_context2.next=4;return window.ethereum.enable();case 4:_context2.next=7;break;case 6:if(window.web3){window.web3=new Web3(window.web3.currentProvider);}else{window.alert('Non-Ethereum browser detected. You should consider trying MetaMask!');}case 7:case\"end\":return _context2.stop();}}},_callee2);}));function loadWeb3(){return _loadWeb.apply(this,arguments);}return loadWeb3;}()},{key:\"loadBlockchainData\",value:function(){var _loadBlockchainData=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){var web3,accounts,networkId,networkData,election,candCount,i,candidates;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:web3=window.web3;_context3.next=3;return web3.eth.getAccounts();case 3:accounts=_context3.sent;console.log(accounts);this.setState({account:accounts[0]});_context3.next=8;return web3.eth.net.getId();case 8:networkId=_context3.sent;networkData=Election.networks[networkId];if(!networkData){_context3.next=29;break;}election=new web3.eth.Contract(Election.abi,networkData.address);this.setState({election:election});_context3.next=15;return election.methods.candidatesCount().call();case 15:candCount=_context3.sent;this.setState({candCount:candCount});i=1;case 18:if(!(i<=candCount)){_context3.next=26;break;}_context3.next=21;return election.methods.candidates(i).call();case 21:candidates=_context3.sent;if(candidates.election_id===this.state.id){this.setState({candidates:[].concat(_toConsumableArray(this.state.candidates),[candidates])});}case 23:i++;_context3.next=18;break;case 26:console.log(this.state.candidates);_context3.next=30;break;case 29:window.alert('Election contract not deployed to detected network.');case 30:case\"end\":return _context3.stop();}}},_callee3,this);}));function loadBlockchainData(){return _loadBlockchainData.apply(this,arguments);}return loadBlockchainData;}()},{key:\"vote\",value:function vote(id){var _this2=this;console.log(this.state.selectedId);this.setState({loading:true});this.state.election.methods.vote(id).send({from:this.state.account}).once('receipt',function(receipt){_this2.setState({loading:false});window.location.assign(\"/\");});}},{key:\"componentDidMount\",value:function componentDidMount(){var id=this.props.match.params.id;this.setState({id:id});}},{key:\"render\",value:function render(){var _this3=this;var electionList=this.state.candidates.map(function(candidates){return/*#__PURE__*/React.createElement(\"div\",{className:\"contact\",key:candidates.id},/*#__PURE__*/React.createElement(\"li\",{className:\"collection-item avatar\"},/*#__PURE__*/React.createElement(\"p\",null,/*#__PURE__*/React.createElement(\"b\",null,\"Name of the Candidate : \",candidates.name)),/*#__PURE__*/React.createElement(\"p\",null,/*#__PURE__*/React.createElement(\"b\",null,\"Name of the Party : \",candidates.details)),/*#__PURE__*/React.createElement(\"a\",{href:\"\",className:\"secondary-content\"},/*#__PURE__*/React.createElement(\"button\",{id:candidates.id,onClick:_this3.handleInputChange,class:\"btn btn-warning \"},\"Vote\"))));});return/*#__PURE__*/React.createElement(\"div\",{class:\"container-fluid\"},/*#__PURE__*/React.createElement(\"div\",{class:\"row\"},/*#__PURE__*/React.createElement(\"div\",{class:\"col-sm-6 login-section-wrapper\"},/*#__PURE__*/React.createElement(\"div\",{class:\"login-wrapper my-auto\"},/*#__PURE__*/React.createElement(\"div\",{className:\"container\"},/*#__PURE__*/React.createElement(\"ul\",{className:\"collection\"},/*#__PURE__*/React.createElement(\"li\",{className:\"collection-item avatar \"},/*#__PURE__*/React.createElement(\"h3\",null,\"Candidates\")),electionList))))));}}]);return Vote;}(Component);export default Vote;","map":{"version":3,"sources":["C:/Users/DELL/Desktop/E-Election-DAPP/blockchain/src/components/custom/Vote.js"],"names":["React","Component","Web3","Election","Link","divStyle","backgroundColor","marginTop","borderRadius","Vote","props","handleInputChange","e","console","log","target","id","setState","selectedId","vote","state","account","election","candCount","candidates","loading","loadWeb3","loadBlockchainData","window","ethereum","web3","enable","currentProvider","alert","eth","getAccounts","accounts","net","getId","networkId","networkData","networks","Contract","abi","address","methods","candidatesCount","call","i","election_id","send","from","once","receipt","location","assign","match","params","electionList","map","name","details"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\r\nimport Web3 from 'web3';\r\nimport Election from '../../build/Election.json'\r\nimport { Link } from 'react-router-dom'\r\n\r\nconst divStyle = {\r\n    backgroundColor:\"lightblue\" ,\r\n    marginTop :\"10px\", \r\n    borderRadius:\"10px\"\r\n}\r\n\r\nclass Vote extends Component {\r\n\r\n    async componentWillMount() {\r\n        await this.loadWeb3()\r\n        await this.loadBlockchainData()\r\n      }\r\n    \r\n    async loadWeb3() {\r\n        if (window.ethereum) {\r\n            window.web3 = new Web3(window.ethereum)\r\n            await window.ethereum.enable()\r\n        }\r\n        else if (window.web3) {\r\n            window.web3 = new Web3(window.web3.currentProvider)\r\n        }\r\n        else {\r\n            window.alert('Non-Ethereum browser detected. You should consider trying MetaMask!')\r\n        }\r\n    }\r\n\r\n    async loadBlockchainData() {\r\n        const web3 = window.web3\r\n        const accounts = await web3.eth.getAccounts()\r\n        console.log(accounts)\r\n        this.setState({ account: accounts[0] })\r\n        const networkId = await web3.eth.net.getId()\r\n        const networkData = Election.networks[networkId]\r\n        if(networkData) {\r\n            const election = new web3.eth.Contract(Election.abi, networkData.address)\r\n            this.setState({ election })\r\n            const candCount = await election.methods.candidatesCount().call()\r\n            this.setState({ candCount })\r\n            for (var i = 1; i <= candCount; i++) {\r\n                const candidates = await election.methods.candidates(i).call()\r\n                if(candidates.election_id === this.state.id){\r\n                    this.setState({\r\n                        candidates: [...this.state.candidates, candidates]\r\n                    })\r\n                }\r\n            }\r\n            console.log(this.state.candidates)\r\n        } else {\r\n            window.alert('Election contract not deployed to detected network.')\r\n        }\r\n    }\r\n\r\n    handleInputChange = (e) => {\r\n        console.log(e.target.id)\r\n        this.setState({\r\n            selectedId: e.target.id,\r\n        })\r\n        this.vote(e.target.id);\r\n    }\r\n\r\n\r\n    vote(id) {\r\n        console.log(this.state.selectedId)\r\n        this.setState({ loading: true })\r\n        this.state.election.methods.vote(id).send({ from: this.state.account })\r\n        .once('receipt', (receipt) => {\r\n            this.setState({ loading: false })\r\n            window.location.assign(\"/\");\r\n        })\r\n    }\r\n\r\n    componentDidMount(){\r\n        let id = this.props.match.params.id;\r\n        this.setState({\r\n            id: id,\r\n        })\r\n    }\r\n\r\n    constructor(props) {\r\n        super(props)\r\n        this.state = {\r\n            id: null,\r\n            account: '',\r\n            election: null,\r\n            candCount: 0,\r\n            candidates: [],\r\n            loading: true,\r\n            selectedId: null\r\n        }\r\n    }\r\n\r\n    render(){\r\n        const electionList = this.state.candidates.map(candidates => {\r\n            return (\r\n                <div className=\"contact\" key={candidates.id} >\r\n                    <li className=\"collection-item avatar\" >\r\n                        {/* <i className=\"material-icons circle blue darken-2\">ballot</i> */}\r\n                        <p><b>Name of the Candidate : {candidates.name}</b></p>\r\n                        <p><b>Name of the Party : {candidates.details}</b></p>\r\n                        <a href=\"\" className=\"secondary-content\"><button id={candidates.id} onClick={this.handleInputChange}  class=\"btn btn-warning \">Vote</button></a>\r\n                    </li>\r\n                </div>\r\n            )\r\n        }) \r\n        return(\r\n            <div class=\"container-fluid\">\r\n            <div class=\"row\">\r\n              <div class=\"col-sm-6 login-section-wrapper\">\r\n\r\n                <div class=\"login-wrapper my-auto\">\r\n            <div className=\"container\" > \r\n                <ul className=\"collection\">\r\n                    <li className=\"collection-item avatar \">\r\n                        <h3>Candidates</h3>\r\n                    </li>\r\n                        {electionList}\r\n                </ul>\r\n            </div>\r\n            </div>\r\n              </div>\r\n              {/* <div class=\"col-sm-6 px-0 d-none d-sm-block\">\r\n                <img src=\"login.jpg\" alt=\"login image\" class=\"login-img\"/>\r\n              </div> */}\r\n            </div>\r\n          </div>\r\n        )\r\n    }\r\n}\r\n\r\nexport default Vote;"]},"metadata":{},"sourceType":"module"}